<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart - UniBite</title>
    <link rel="stylesheet" href="/Styles/Cart.css" />
</head>
<body>
<div class="cart-container">
    <!-- Items Section -->
    <div class="items-section">
        <h2>Your Cart</h2>
        <p>Review and checkout your order</p>

        <div class="items-header">
            <h3 id="cart-count-label">Items (0)</h3>
            <button class="clear-cart" onclick="clearCart()">Clear Cart</button>
        </div>

        <div id="cart-items-list">
            <!-- Items will be populated by JavaScript -->
        </div>

        <p id="empty-cart-msg" class="empty-cart" style="display: none;">Your cart is empty</p>

        <a href="/stores" class="continue-shopping">‚Üê Continue Shopping</a>
    </div>

    <!-- Summary Section -->
    <div class="summary-section">
        <div class="order-summary">
            <h3>Order Summary</h3>
            <div class="summary-item">
                <span>Subtotal</span>
                <span id="cart-subtotal">0 EGP</span>
            </div>
            <div class="summary-item">
                <span>Pickup Fee</span>
                <span>Free</span>
            </div>
            <div class="summary-total">
                <span>Total</span>
                <span id="cart-total">0 EGP</span>
            </div>
            <button class="checkout-button" onclick="proceedToCheckout()">Checkout</button>
        </div>

        <div class="info-section">
            <div class="pickup-info">
                <h4>Pickup Information</h4>
                <p>Your order will be available for pickup at the respective store locations. You'll receive a notification when each item is ready.</p>
            </div>
            <div class="payment-methods">
                <h4>Payment Methods</h4>
                <p>Pay with cash on pickup.</p>
            </div>
        </div>
    </div>
</div>

<script>
function getCartObj() {
    try {
        return JSON.parse(localStorage.getItem('cartObj')) || {};
    } catch (e) { return {}; }
}

function setCartObj(cartObj) {
    localStorage.setItem('cartObj', JSON.stringify(cartObj));
}

function getCart() {
    const cartObj = getCartObj();
    return cartObj.items || [];
}

function renderCart() {
    const cart = getCart();
    const cartList = document.getElementById('cart-items-list');
    const emptyCartMsg = document.getElementById('empty-cart-msg');
    const cartCountLabel = document.getElementById('cart-count-label');
    const cartSubtotal = document.getElementById('cart-subtotal');
    const cartTotal = document.getElementById('cart-total');
    
    cartList.innerHTML = '';
    let subtotal = 0;

    if (cart.length === 0) {
        emptyCartMsg.style.display = 'block';
    } else {
        emptyCartMsg.style.display = 'none';
    }

    cartCountLabel.textContent = `Items (${cart.length})`;

    cart.forEach((item, idx) => {
        subtotal += item.price * item.quantity;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
            <div class="item-details">
                <div class="item-image" style="background-image: url('${item.image}')"></div>
                <div class="item-info">
                    <h4>${item.name}</h4>
                    <p>${item.category}</p>
                    <div class="item-quantity">
                        <button class="qty-btn" data-idx="${idx}" data-change="-1">-</button>
                        <span>${item.quantity}</span>
                        <button class="qty-btn" data-idx="${idx}" data-change="1">+</button>
                    </div>
                    ${item.notes ? `<div class='item-notes'><em>Notes: ${item.notes}</em></div>` : ''}
                    ${item.options && Object.keys(item.options).length > 0 ? `<div class='item-options'><em>Options: ${Object.entries(item.options).map(([k,v]) => `${k}: ${Array.isArray(v)?v.join(', '):v}`).join(' | ')}</em></div>` : ''}
                </div>
            </div>
            <div class="item-price">
                <p>${item.price * item.quantity} EGP</p>
                <button class="remove-item" data-idx="${idx}">üóë</button>
            </div>
        `;
        cartList.appendChild(div);
    });

    cartSubtotal.textContent = subtotal + ' EGP';
    cartTotal.textContent = subtotal + ' EGP';
}

// Quantity change
document.getElementById('cart-items-list').addEventListener('click', function(e) {
    if (e.target.classList.contains('qty-btn')) {
        const idx = parseInt(e.target.getAttribute('data-idx'));
        const change = parseInt(e.target.getAttribute('data-change'));
        let cartObj = getCartObj();
        let cart = cartObj.items || [];
        if (cart[idx]) {
            cart[idx].quantity += change;
            if (cart[idx].quantity <= 0) cart.splice(idx, 1);
            cartObj.items = cart;
            setCartObj(cartObj);
            renderCart();
        }
    }
    if (e.target.classList.contains('remove-item')) {
        const idx = parseInt(e.target.getAttribute('data-idx'));
        let cartObj = getCartObj();
        let cart = cartObj.items || [];
        cart.splice(idx, 1);
        cartObj.items = cart;
        setCartObj(cartObj);
        renderCart();
    }
});

function clearCart() {
    setCartObj({});
    renderCart();
}

function proceedToCheckout() {
    const cart = getCart();
    if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
    }
    window.location.href = '/checkout';
}

// Initial render
renderCart();
</script>
</body>
</html> 